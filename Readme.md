# Импорт сотрудников в СУБД MySQL из CSV

## Постановка задачи
Необходимо реализовать процедуру загрузки, актуализации и хранения данных в реляционной БД, для следующего кейса:

На обработку периодически поступает файл в формате CSV с данными пользователей корпоративной системы. Файл содержит полный набор корпоративных пользователей на момент создания файла. Пользователи в файле могут добавляться, изменяться и удаляться.

Необходимо произвести анализ поступающих данных, спроектировать и реализовать структуру БД и методы загрузки.

## Инструкция по запуску

Используемая СУБД: **MySQL**. Тип - **InnoDB**. Кодировка - **utf8_general_ci**

Формат файла на входе должен быть идентичен шаблону **import.csv**

Путь к файлу для импорта задается в файле`index.php:11` `$csv = new ImportFromCsv("Путь к файлу");`

Настройки подключения к БД задаются в классе `Classes\ImportFromCsv.php`

    const DB_HOST = '127.0.0.1'; //Сервер
    const DB_NAME = 'company'; //Имя БД
    const DB_USER = 'root'; // Пользователь
    const DB_PWD = ''; //Пароль

При первоначальном запуске, если настроено подключение к БД, запустится метод создания структуры БД. 
Если структура БД будет обнаружена (проверка по таблице `employees`), то этот этап будет пропущен.

Результат работы: кол-во добавленных/обновленных/удаленных пользователей.

Для приложенного файла **import.csv** при первой обработке результат выполнения будет следующий: 

`{ "insertCount":49,
"updateCount":3,
"removeCount":0 }`

**Что означает**: 
+ Добавлено 49 сотрудников
+ Обновлено 3 сотрудника (3 сотрудника в исходном файле дублируются)
+ Удалено 0 сотрудников.

## Описание работы
+ Обязательным полем является только первое поле `ФИО`.
+ Реализовано "мягкое" удаление записей с проставлением даты удаления в полях `deleted_at`. Если при последующей загрузке сотрудник снова появится в загружаемом списке, то этот признак будет удален.
+ Для `организаций`, `должностей`, `видов трудоустройства` реализованы однотипные справочники, невостребованные записи которых также получают признак `deleted_at` в соответствующем случае.
+ Реализована проверка на корректность заполнения полей `дата рождения`, `дата приема`, а также на корректный адрес `электронной почты`. `Номер телефона` не только валидируется, но и приводится к стандартизованному виду.
+ В случае некорректного заполнения, описание ошибки пишется в поле `log`, которое при следующей загрузке обновляется. 